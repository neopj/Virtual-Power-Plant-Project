import sys

from pyspark import SparkContext
from pyspark.sql import SparkSession
from pyspark.sql.types import * 
from pyspark.sql import functions as F
from pyspark.sql.functions import *
from pyspark.sql.functions import col, isnan, when, trim, instr, split, isnan

# Required to allow the file to be submitted and run using spark-submit instead
# of using pyspark interactively

spark = SparkSession.builder.getOrCreate()
sc = SparkContext.getOrCreate()

# define the date change function
import glob
import pandas as pd
import csv
import numpy as np
from datetime import time
from datetime import datetime
from datetime import timedelta

from pyspark.sql.functions import col, udf

def utc_to_nzt(d):
    date_range_mapping = {
        '2016': ('2016-04-02T14:00:00.000Z','2016-09-24T14:00:00:000Z'),
        '2017': ('2017-04-01T14:00:00.000Z','2017-09-23T14:00:00:000Z'),
        '2018': ('2018-03-31T14:00:00.000Z','2018-09-29T14:00:00:000Z'),
        '2019': ('2019-04-06T14:00:00.000Z','2019-09-28T14:00:00:000Z'),
    }
    start_date, end_date = date_range_mapping[d[:4]]
    if d >= start_date:
        if d < end_date:
            tempd = datetime.strptime(d,"%Y-%m-%dT%H:%M:%S.%fZ")
            dt = tempd + timedelta(hours = 12)
            newd = dt.strftime('%Y-%m-%dT%H:%M:%S.%fZ')
            return newd
        else:
            tempd = datetime.strptime(d,"%Y-%m-%dT%H:%M:%S.%fZ")
            dt = tempd + timedelta(hours = 13)
            newd = dt.strftime('%Y-%m-%dT%H:%M:%S.%fZ')
            return newd
    else:
        tempd = datetime.strptime(d,"%Y-%m-%dT%H:%M:%S.%fZ")
        dt = tempd + timedelta(hours = 13)
        newd = dt.strftime('%Y-%m-%dT%H:%M:%S.%fZ')
        return newd

utc_to_nzt_udf = udf(utc_to_nzt, StringType())

# define the data schema of hwd
schema_hwd = StructType([
    StructField("ID", StringType(), True),
    StructField("Index", StringType(), True),
    StructField("Score", DoubleType(), True),
    StructField("Date", StringType(), True),
    StructField("ICP", StringType(), True),
    StructField("Mac", StringType(), True),
    StructField("ReadType", StringType(), True),
    StructField("Value", StringType(), True),
    StructField("Type", StringType(), True),
    StructField("Inserted", StringType(), True),
])

hwd = (
    spark.read.format("com.databricks.spark.csv")
    .option("header", "false")
    .option("inferSchema", "false")
    .schema(schema_hwd)
    .load("hdfs:///user/jpe116/project/hwd.csv")
)

hwd.cache()
hwd.show(10, False)
hwd.count() #42,692,044

+-------------------------------------------------------------+-----------+-----+------------------------+---------------+-----------------+-------------+-----+--------+--------+
|ID                                                           |Index      |Score|Date                    |ICP            |Mac              |ReadType     |Value|Type    |Inserted|
+-------------------------------------------------------------+-----------+-----+------------------------+---------------+-----------------+-------------+-----+--------+--------+
|null                                                         |null       |null |null                    |null           |null             |null         |null |null    |null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482974700000|hwd-2016-12|1.0  |2016-12-29T01:25:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482947400000|hwd-2016-12|1.0  |2016-12-28T17:50:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482972900000|hwd-2016-12|1.0  |2016-12-29T00:55:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482989400000|hwd-2016-12|1.0  |2016-12-29T05:30:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482931800000|hwd-2016-12|1.0  |2016-12-28T13:30:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482950700000|hwd-2016-12|1.0  |2016-12-28T18:45:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482990300000|hwd-2016-12|1.0  |2016-12-29T05:45:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482992100000|hwd-2016-12|1.0  |2016-12-29T06:15:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
|0413656012LC018:4C:55:CC:13:F1:48:hotwater-grid:1482927000000|hwd-2016-12|1.0  |2016-12-28T12:10:00.000Z|0413656012LC018|4C:55:CC:13:F1:48|hotwater-grid|0.0  |readings|null    |
+-------------------------------------------------------------+-----------+-----+------------------------+---------------+-----------------+-------------+-----+--------+--------+
only showing top 10 rows

nodupli_hwd = hwd.dropDuplicates()
nodupli_hwd.count() # 42,692,044 no duplicates

noempty_hwd = (
    nodupli_hwd
    .filter(col('ID').isNotNull())
)
noempty_hwd.count() # 42,692,043 remove one empty value

NZTC_hwd = (
   noempty_hwd
   .withColumn('DateTransformed', utc_to_nzt_udf(col('Date'))) # convert timestamp from UTC to local New Zealand time stamp
)

NZTC_hwd.show(5, False)

+---------------------------------------------------------+-----------+-----+------------------------+---------------+-----------------+---------+-----+--------+--------+---------------------------+
|ID                                                       |Index      |Score|Date                    |ICP            |Mac              |ReadType |Value|Type    |Inserted|DateTransformed            |
+---------------------------------------------------------+-----------+-----+------------------------+---------------+-----------------+---------+-----+--------+--------+---------------------------+
|0000008961CPDC9:4C:55:CC:13:F1:4C:WaterTemp:1498533600000|hwd-2017-06|1.0  |2017-06-27T03:20:00.000Z|0000008961CPDC9|4C:55:CC:13:F1:4C|WaterTemp|54.5 |readings|null    |2017-06-27T15:20:00.000000Z|
|0000008961CPDC9:4C:55:CC:13:F1:4C:WaterTemp:1498534200000|hwd-2017-06|1.0  |2017-06-27T03:30:00.000Z|0000008961CPDC9|4C:55:CC:13:F1:4C|WaterTemp|53.5 |readings|null    |2017-06-27T15:30:00.000000Z|
|0000008961CPDC9:4C:55:CC:13:F1:4C:WaterTemp:1498534800000|hwd-2017-06|1.0  |2017-06-27T03:40:00.000Z|0000008961CPDC9|4C:55:CC:13:F1:4C|WaterTemp|53.0 |readings|null    |2017-06-27T15:40:00.000000Z|
|0000008961CPDC9:4C:55:CC:13:F1:4C:WaterTemp:1498536300000|hwd-2017-06|1.0  |2017-06-27T04:05:00.000Z|0000008961CPDC9|4C:55:CC:13:F1:4C|WaterTemp|51.88|readings|null    |2017-06-27T16:05:00.000000Z|
|0000008961CPDC9:4C:55:CC:13:F1:4C:WaterTemp:1498537800000|hwd-2017-06|1.0  |2017-06-27T04:30:00.000Z|0000008961CPDC9|4C:55:CC:13:F1:4C|WaterTemp|51.06|readings|null    |2017-06-27T16:30:00.000000Z|
+---------------------------------------------------------+-----------+-----+------------------------+---------------+-----------------+---------+-----+--------+--------+---------------------------+

NZTC_hwd.select("ICP").distinct().count() # 78
NZTC_hwd.select("ICP").distinct().show(78,False) # show distinct ICP in hwd

ICP            |
+---------------+
|0000047136CPAF3|
|0000067241CP8AA|
|0000137630TR4E0|
|0000466158UN3D9|
|0000684395UN78F|
|0001404973UN7F4|
|0006306700CA330|
|0110004799ELE19|
|0327410930LC154|
|0360890784LCA00|
|0403844738LC3E2|
|0545098421LC718|
|0729814860LCE08|
|1001154207CK638|
|1001156744CKE18|
|0000008961CPDC9|
|0000014035CPEA3|
|0000061132CP7F4|
|0000062523CPFFD|
|0000066859CPBB9|
|0000066994CPA09|
|0000131512UN52B|
|0000137131TR7A7|
|0000138039UNF0F|
|0000172950TR8AA|
|0000189290UNCEF|
|0000240706UN326|
|0001429488UNFD2|
|0006783759RNEF1|
|0006783830RN05F|
|0006784488RN895|
|0033300872PC9B7|
|0228604273LCC60|
|0330451049LC2CF|
|0338948503LC0CB|
|0452471036LC5A7|
|0488413184LC3D8|
|0900089925PCCA4|
|1000554796PC982|
|0000017761CPA43|
|0000039660CPE0F|
|0000043262CP672|
|0000053320CP5B7|
|0000057790CPD84|
|0000059543CPEC1|
|0000129915TRBD4|
|0000222606UNB3A|
|0000460470UNC5D|
|0000639403UN2CC|
|0006783740RNA0D|
|0006783775RN0BA|
|0007068166RN1FE|
|0007160293RN6C9|
|0036710554PC569|
|0413656012LC018|
|0457457422LCA5E|
|1001260821LC599|
|0000033594CP251|
|0000035335CP5CD|
|0000046401CP464|
|0000049837CP77F|
|0000056020CP194|
|0000064949CPB50|
|0000123006UN028|
|0000144357TRB86|
|0000158016TR504|
|0000169665TRA13|
|0000213468UNDDA|
|0000445293UN2CC|
|0000459323UNA1B|
|0006783783RN122|
|0048152143LC831|
|0110009110EL924|
|0332939464LC848|
|0414614372LCD1E|
|0432928049LC968|
|0900085431PC98B|
|1001265690LCA45|
+---------------+

NZTC_hwd.coalesce(1).write.format('com.databricks.spark.csv').option("header", "true").save('/user/jpe116/output/finaldata/final_hwd')

hdfs dfs -ls /user/jpe116/output/finaldata




generation_hwd = (
    NZTC_hwd
    .select(["Date","ICP","ReadType","Value","DateTransformed"])
    .filter(col('ReadType') == 'generation')   
)

generation_hwd.cache()
generation_hwd.show(5,False)
generation_hwd.count() # 7082554

nodupli_generation_hwd = generation_hwd.dropDuplicates() # 1317 duplicates
nodupli_generation_hwd.count() # 7,081,237

nodupli_generation_hwd.select("ICP").distinct().count() # 78


# save output as csv
nodupli_generation_hwd.coalesce(1).write.format('com.databricks.spark.csv').option("header", "true").save('/user/jpe116/output/finaldata/generation_hwd')

hdfs dfs -ls /user/jpe116/output/finaldata

ICP_hwd = (
  generation_hwd
  .groupBy('ICP')
  .agg(F.min("Date").alias("Start_date"),
       F.max("Date").alias("End_date")
       )
)

ICP_hwd.show(80,False)
+---------------+------------------------+------------------------+
|ICP            |Start_date              |End_date                |
+---------------+------------------------+------------------------+
|0000047136CPAF3|2017-06-28T23:20:00.000Z|2017-11-09T04:00:00.000Z|
|0000067241CP8AA|2017-06-27T23:10:00.000Z|2019-05-10T09:00:00.000Z|
|0000137630TR4E0|2017-11-08T22:05:00.000Z|2019-05-25T14:40:00.000Z|
|0000466158UN3D9|2017-03-16T23:15:00.000Z|2019-02-07T11:55:00.000Z|
|0000684395UN78F|2017-03-28T20:50:00.000Z|2017-11-06T09:45:00.000Z|
|0001404973UN7F4|2017-09-19T03:05:00.000Z|2019-04-10T13:15:00.000Z|
|0006306700CA330|2017-07-05T00:10:00.000Z|2018-03-21T03:35:00.000Z|
|0110004799ELE19|2017-06-15T03:15:00.000Z|2018-07-18T04:40:00.000Z|
|0327410930LC154|2017-01-16T00:55:00.000Z|2019-04-06T04:30:00.000Z|
|0360890784LCA00|2017-01-16T03:40:00.000Z|2017-10-01T09:45:00.000Z|
|0403844738LC3E2|2017-04-10T04:15:00.000Z|2018-12-15T09:00:00.000Z|
|0545098421LC718|2017-03-16T20:40:00.000Z|2019-05-24T03:25:00.000Z|
|0729814860LCE08|2017-01-15T22:45:00.000Z|2019-04-03T06:10:00.000Z|
|1001154207CK638|2016-11-19T01:40:00.000Z|2019-05-24T03:25:00.000Z|
|1001156744CKE18|2016-11-21T03:15:00.000Z|2017-12-26T06:10:00.000Z|
|0000008961CPDC9|2017-06-27T03:15:00.000Z|2018-09-12T23:30:00.000Z|
|0000014035CPEA3|2017-06-07T23:25:00.000Z|2017-06-27T03:10:00.000Z|
|0000061132CP7F4|2017-07-03T04:30:00.000Z|2019-05-24T03:25:00.000Z|
|0000062523CPFFD|2017-07-04T03:50:00.000Z|2019-05-24T03:25:00.000Z|
|0000066859CPBB9|2017-06-21T00:00:00.000Z|2017-09-17T12:00:00.000Z|
|0000066994CPA09|2017-06-06T01:40:00.000Z|2019-05-24T03:25:00.000Z|
|0000131512UN52B|2017-04-03T04:05:00.000Z|2017-05-31T05:05:00.000Z|
|0000137131TR7A7|2016-11-19T01:40:00.000Z|2019-04-03T03:30:00.000Z|
|0000138039UNF0F|2017-01-15T05:15:00.000Z|2017-08-11T08:45:00.000Z|
|0000172950TR8AA|2017-12-22T03:40:00.000Z|2018-11-14T21:05:00.000Z|
|0000189290UNCEF|2017-01-17T23:25:00.000Z|2018-07-13T06:20:00.000Z|
|0000240706UN326|2017-03-29T02:15:00.000Z|2018-02-22T06:25:00.000Z|
|0001429488UNFD2|2017-01-17T23:05:00.000Z|2017-04-23T06:15:00.000Z|
|0006783759RNEF1|2017-11-28T05:35:00.000Z|2018-07-01T01:55:00.000Z|
|0006783830RN05F|2017-10-09T09:45:00.000Z|2018-07-13T02:30:00.000Z|
|0006784488RN895|2017-10-14T19:55:00.000Z|2017-10-17T06:10:00.000Z|
|0033300872PC9B7|2017-06-12T03:35:00.000Z|2017-10-21T05:35:00.000Z|
|0228604273LCC60|2016-11-16T19:50:00.000Z|2017-10-30T22:00:00.000Z|
|0330451049LC2CF|2017-03-27T21:50:00.000Z|2019-05-24T03:25:00.000Z|
|0338948503LC0CB|2017-01-12T21:45:00.000Z|2019-03-02T20:45:00.000Z|
|0452471036LC5A7|2017-03-09T23:25:00.000Z|2017-07-30T04:40:00.000Z|
|0488413184LC3D8|2017-01-15T22:55:00.000Z|2018-08-06T05:10:00.000Z|
|0900089925PCCA4|2017-06-08T06:15:00.000Z|2019-05-24T03:25:00.000Z|
|1000554796PC982|2017-06-07T00:50:00.000Z|2017-11-14T02:20:00.000Z|
|0000017761CPA43|2017-06-21T05:05:00.000Z|2019-05-24T03:25:00.000Z|
|0000039660CPE0F|2017-07-12T04:00:00.000Z|2017-07-14T00:25:00.000Z|
|0000043262CP672|2017-06-09T04:35:00.000Z|2018-07-16T22:35:00.000Z|
|0000053320CP5B7|2017-06-20T03:00:00.000Z|2018-09-07T10:25:00.000Z|
|0000057790CPD84|2017-06-26T00:25:00.000Z|2018-10-12T01:55:00.000Z|
|0000059543CPEC1|2017-07-04T01:05:00.000Z|2018-09-04T21:15:00.000Z|
|0000129915TRBD4|2017-12-18T00:30:00.000Z|2018-12-01T22:05:00.000Z|
|0000222606UNB3A|2017-03-07T00:20:00.000Z|2017-09-24T17:55:00.000Z|
|0000460470UNC5D|2017-03-06T21:45:00.000Z|2017-11-17T01:20:00.000Z|
|0000639403UN2CC|2017-03-17T01:55:00.000Z|2019-05-21T02:50:00.000Z|
|0006783740RNA0D|2017-10-02T20:50:00.000Z|2019-05-09T01:35:00.000Z|
|0006783775RN0BA|2017-11-06T02:55:00.000Z|2019-05-24T03:25:00.000Z|
|0007068166RN1FE|2017-11-28T01:35:00.000Z|2018-07-12T17:40:00.000Z|
|0007160293RN6C9|2017-11-01T23:45:00.000Z|2019-05-24T03:25:00.000Z|
|0036710554PC569|2017-06-22T02:30:00.000Z|2019-05-02T08:50:00.000Z|
|0413656012LC018|2016-11-19T03:15:00.000Z|2018-05-13T02:50:00.000Z|
|0457457422LCA5E|2017-03-07T20:20:00.000Z|2019-03-21T23:20:00.000Z|
|1001260821LC599|2017-03-13T21:00:00.000Z|2019-02-28T06:10:00.000Z|
|0000033594CP251|2017-06-28T04:15:00.000Z|2019-05-24T03:25:00.000Z|
|0000035335CP5CD|2017-08-24T05:15:00.000Z|2019-05-24T03:25:00.000Z|
|0000046401CP464|2017-06-29T23:15:00.000Z|2018-01-29T16:30:00.000Z|
|0000049837CP77F|2017-06-20T00:10:00.000Z|2018-07-06T00:25:00.000Z|
|0000056020CP194|2017-08-11T00:05:00.000Z|2017-10-18T10:35:00.000Z|
|0000064949CPB50|2017-07-11T22:50:00.000Z|2018-04-14T06:05:00.000Z|
|0000123006UN028|2017-01-13T05:40:00.000Z|2018-06-14T00:45:00.000Z|
|0000144357TRB86|2017-11-08T01:35:00.000Z|2018-07-06T02:25:00.000Z|
|0000158016TR504|2016-12-22T22:35:00.000Z|2018-12-19T05:45:00.000Z|
|0000169665TRA13|2017-09-18T02:25:00.000Z|2019-05-24T03:25:00.000Z|
|0000213468UNDDA|2017-01-18T04:40:00.000Z|2017-12-25T20:40:00.000Z|
|0000445293UN2CC|2016-11-22T01:55:00.000Z|2017-05-12T14:20:00.000Z|
|0000459323UNA1B|2017-04-03T21:20:00.000Z|2019-03-22T02:35:00.000Z|
|0006783783RN122|2017-09-22T00:50:00.000Z|2019-05-24T03:25:00.000Z|
|0048152143LC831|2017-03-07T22:40:00.000Z|2017-06-24T23:55:00.000Z|
|0110009110EL924|2017-07-23T23:10:00.000Z|2019-02-01T19:55:00.000Z|
|0332939464LC848|2017-03-14T00:30:00.000Z|2018-04-16T23:40:00.000Z|
|0414614372LCD1E|2017-03-09T21:10:00.000Z|2019-05-24T03:25:00.000Z|
|0432928049LC968|2017-01-13T03:05:00.000Z|2019-05-10T04:00:00.000Z|
|0900085431PC98B|2017-06-30T04:55:00.000Z|2018-05-09T18:50:00.000Z|
|1001265690LCA45|2017-03-28T02:55:00.000Z|2019-05-24T03:25:00.000Z|
+---------------+------------------------+------------------------+



ICP_missing_hwd = (
  generation_hwd
  .groupBy("ICP")
  .agg(F.countDistinct("Date").alias("Count")
       )
)

ICP_missing_hwd.show(80,False)

+---------------+------+
|ICP            |Count |
+---------------+------+
|0000047136CPAF3|33276 |
|0000067241CP8AA|153703|
|0000137630TR4E0|106188|
|0000466158UN3D9|30637 |
|0000684395UN78F|49382 |
|0001404973UN7F4|113623|
|0006306700CA330|57677 |
|0110004799ELE19|97246 |
|0327410930LC154|192688|
|0360890784LCA00|50759 |
|0403844738LC3E2|124363|
|0545098421LC718|163171|
|0729814860LCE08|197508|
|1001154207CK638|197888|
|1001156744CKE18|72289 |
|0000008961CPDC9|115457|
|0000014035CPEA3|3142  |
|0000061132CP7F4|146395|
|0000062523CPFFD|177181|
|0000066859CPBB9|12259 |
|0000066994CPA09|170683|
|0000131512UN52B|8493  |
|0000137131TR7A7|173842|
|0000138039UNF0F|41476 |
|0000172950TR8AA|23860 |
|0000189290UNCEF|90128 |
|0000240706UN326|85361 |
|0001429488UNFD2|11084 |
|0006783759RNEF1|8573  |
|0006783830RN05F|34858 |
|0006784488RN895|694   |
|0033300872PC9B7|15718 |
|0228604273LCC60|91938 |
|0330451049LC2CF|183450|
|0338948503LC0CB|184643|
|0452471036LC5A7|27192 |
|0488413184LC3D8|139153|
|0900089925PCCA4|180105|
|1000554796PC982|36649 |
|0000017761CPA43|159405|
|0000039660CPE0F|516   |
|0000043262CP672|88612 |
|0000053320CP5B7|6276  |
|0000057790CPD84|67807 |
|0000059543CPEC1|104180|
|0000129915TRBD4|88947 |
|0000222606UNB3A|53599 |
|0000460470UNC5D|31147 |
|0000639403UN2CC|194955|
|0006783740RNA0D|106043|
|0006783775RN0BA|102123|
|0007068166RN1FE|1481  |
|0007160293RN6C9|61648 |
|0036710554PC569|169877|
|0413656012LC018|91922 |
|0457457422LCA5E|130916|
|1001260821LC599|175342|
|0000033594CP251|158377|
|0000035335CP5CD|153598|
|0000046401CP464|34352 |
|0000049837CP77F|85010 |
|0000056020CP194|17797 |
|0000064949CPB50|27583 |
|0000123006UN028|99779 |
|0000144357TRB86|52619 |
|0000158016TR504|176254|
|0000169665TRA13|152162|
|0000213468UNDDA|49402 |
|0000445293UN2CC|25712 |
|0000459323UNA1B|18075 |
|0006783783RN122|132180|
|0048152143LC831|9209  |
|0110009110EL924|131305|
|0332939464LC848|85559 |
|0414614372LCD1E|152283|
|0432928049LC968|46593 |
|0900085431PC98B|44628 |
|1001265690LCA45|188545|
+---------------+------+


missing_info_hwd = (
    ICP_hwd
    .join(
    ICP_missing_hwd,
    on = "ICP",
    how = "left"
    )
)

missing_info_hwd.show(80,False)
missing_info_hwd.count()

+---------------+------------------------+------------------------+------+
|ICP            |Start_date              |End_date                |Count |
+---------------+------------------------+------------------------+------+
|0000047136CPAF3|2017-06-28T23:20:00.000Z|2017-11-09T04:00:00.000Z|33276 |
|0000067241CP8AA|2017-06-27T23:10:00.000Z|2019-05-10T09:00:00.000Z|153703|
|0000137630TR4E0|2017-11-08T22:05:00.000Z|2019-05-25T14:40:00.000Z|106188|
|0000466158UN3D9|2017-03-16T23:15:00.000Z|2019-02-07T11:55:00.000Z|30637 |
|0000684395UN78F|2017-03-28T20:50:00.000Z|2017-11-06T09:45:00.000Z|49382 |
|0001404973UN7F4|2017-09-19T03:05:00.000Z|2019-04-10T13:15:00.000Z|113623|
|0006306700CA330|2017-07-05T00:10:00.000Z|2018-03-21T03:35:00.000Z|57677 |
|0110004799ELE19|2017-06-15T03:15:00.000Z|2018-07-18T04:40:00.000Z|97246 |
|0327410930LC154|2017-01-16T00:55:00.000Z|2019-04-06T04:30:00.000Z|192688|
|0360890784LCA00|2017-01-16T03:40:00.000Z|2017-10-01T09:45:00.000Z|50759 |
|0403844738LC3E2|2017-04-10T04:15:00.000Z|2018-12-15T09:00:00.000Z|124363|
|0545098421LC718|2017-03-16T20:40:00.000Z|2019-05-24T03:25:00.000Z|163171|
|0729814860LCE08|2017-01-15T22:45:00.000Z|2019-04-03T06:10:00.000Z|197508|
|1001154207CK638|2016-11-19T01:40:00.000Z|2019-05-24T03:25:00.000Z|197888|
|1001156744CKE18|2016-11-21T03:15:00.000Z|2017-12-26T06:10:00.000Z|72289 |
|0000008961CPDC9|2017-06-27T03:15:00.000Z|2018-09-12T23:30:00.000Z|115457|
|0000014035CPEA3|2017-06-07T23:25:00.000Z|2017-06-27T03:10:00.000Z|3142  |
|0000061132CP7F4|2017-07-03T04:30:00.000Z|2019-05-24T03:25:00.000Z|146395|
|0000062523CPFFD|2017-07-04T03:50:00.000Z|2019-05-24T03:25:00.000Z|177181|
|0000066859CPBB9|2017-06-21T00:00:00.000Z|2017-09-17T12:00:00.000Z|12259 |
|0000066994CPA09|2017-06-06T01:40:00.000Z|2019-05-24T03:25:00.000Z|170683|
|0000131512UN52B|2017-04-03T04:05:00.000Z|2017-05-31T05:05:00.000Z|8493  |
|0000137131TR7A7|2016-11-19T01:40:00.000Z|2019-04-03T03:30:00.000Z|173842|
|0000138039UNF0F|2017-01-15T05:15:00.000Z|2017-08-11T08:45:00.000Z|41476 |
|0000172950TR8AA|2017-12-22T03:40:00.000Z|2018-11-14T21:05:00.000Z|23860 |
|0000189290UNCEF|2017-01-17T23:25:00.000Z|2018-07-13T06:20:00.000Z|90128 |
|0000240706UN326|2017-03-29T02:15:00.000Z|2018-02-22T06:25:00.000Z|85361 |
|0001429488UNFD2|2017-01-17T23:05:00.000Z|2017-04-23T06:15:00.000Z|11084 |
|0006783759RNEF1|2017-11-28T05:35:00.000Z|2018-07-01T01:55:00.000Z|8573  |
|0006783830RN05F|2017-10-09T09:45:00.000Z|2018-07-13T02:30:00.000Z|34858 |
|0006784488RN895|2017-10-14T19:55:00.000Z|2017-10-17T06:10:00.000Z|694   |
|0033300872PC9B7|2017-06-12T03:35:00.000Z|2017-10-21T05:35:00.000Z|15718 |
|0228604273LCC60|2016-11-16T19:50:00.000Z|2017-10-30T22:00:00.000Z|91938 |
|0330451049LC2CF|2017-03-27T21:50:00.000Z|2019-05-24T03:25:00.000Z|183450|
|0338948503LC0CB|2017-01-12T21:45:00.000Z|2019-03-02T20:45:00.000Z|184643|
|0452471036LC5A7|2017-03-09T23:25:00.000Z|2017-07-30T04:40:00.000Z|27192 |
|0488413184LC3D8|2017-01-15T22:55:00.000Z|2018-08-06T05:10:00.000Z|139153|
|0900089925PCCA4|2017-06-08T06:15:00.000Z|2019-05-24T03:25:00.000Z|180105|
|1000554796PC982|2017-06-07T00:50:00.000Z|2017-11-14T02:20:00.000Z|36649 |
|0000017761CPA43|2017-06-21T05:05:00.000Z|2019-05-24T03:25:00.000Z|159405|
|0000039660CPE0F|2017-07-12T04:00:00.000Z|2017-07-14T00:25:00.000Z|516   |
|0000043262CP672|2017-06-09T04:35:00.000Z|2018-07-16T22:35:00.000Z|88612 |
|0000053320CP5B7|2017-06-20T03:00:00.000Z|2018-09-07T10:25:00.000Z|6276  |
|0000057790CPD84|2017-06-26T00:25:00.000Z|2018-10-12T01:55:00.000Z|67807 |
|0000059543CPEC1|2017-07-04T01:05:00.000Z|2018-09-04T21:15:00.000Z|104180|
|0000129915TRBD4|2017-12-18T00:30:00.000Z|2018-12-01T22:05:00.000Z|88947 |
|0000222606UNB3A|2017-03-07T00:20:00.000Z|2017-09-24T17:55:00.000Z|53599 |
|0000460470UNC5D|2017-03-06T21:45:00.000Z|2017-11-17T01:20:00.000Z|31147 |
|0000639403UN2CC|2017-03-17T01:55:00.000Z|2019-05-21T02:50:00.000Z|194955|
|0006783740RNA0D|2017-10-02T20:50:00.000Z|2019-05-09T01:35:00.000Z|106043|
|0006783775RN0BA|2017-11-06T02:55:00.000Z|2019-05-24T03:25:00.000Z|102123|
|0007068166RN1FE|2017-11-28T01:35:00.000Z|2018-07-12T17:40:00.000Z|1481  |
|0007160293RN6C9|2017-11-01T23:45:00.000Z|2019-05-24T03:25:00.000Z|61648 |
|0036710554PC569|2017-06-22T02:30:00.000Z|2019-05-02T08:50:00.000Z|169877|
|0413656012LC018|2016-11-19T03:15:00.000Z|2018-05-13T02:50:00.000Z|91922 |
|0457457422LCA5E|2017-03-07T20:20:00.000Z|2019-03-21T23:20:00.000Z|130916|
|1001260821LC599|2017-03-13T21:00:00.000Z|2019-02-28T06:10:00.000Z|175342|
|0000033594CP251|2017-06-28T04:15:00.000Z|2019-05-24T03:25:00.000Z|158377|
|0000035335CP5CD|2017-08-24T05:15:00.000Z|2019-05-24T03:25:00.000Z|153598|
|0000046401CP464|2017-06-29T23:15:00.000Z|2018-01-29T16:30:00.000Z|34352 |
|0000049837CP77F|2017-06-20T00:10:00.000Z|2018-07-06T00:25:00.000Z|85010 |
|0000056020CP194|2017-08-11T00:05:00.000Z|2017-10-18T10:35:00.000Z|17797 |
|0000064949CPB50|2017-07-11T22:50:00.000Z|2018-04-14T06:05:00.000Z|27583 |
|0000123006UN028|2017-01-13T05:40:00.000Z|2018-06-14T00:45:00.000Z|99779 |
|0000144357TRB86|2017-11-08T01:35:00.000Z|2018-07-06T02:25:00.000Z|52619 |
|0000158016TR504|2016-12-22T22:35:00.000Z|2018-12-19T05:45:00.000Z|176254|
|0000169665TRA13|2017-09-18T02:25:00.000Z|2019-05-24T03:25:00.000Z|152162|
|0000213468UNDDA|2017-01-18T04:40:00.000Z|2017-12-25T20:40:00.000Z|49402 |
|0000445293UN2CC|2016-11-22T01:55:00.000Z|2017-05-12T14:20:00.000Z|25712 |
|0000459323UNA1B|2017-04-03T21:20:00.000Z|2019-03-22T02:35:00.000Z|18075 |
|0006783783RN122|2017-09-22T00:50:00.000Z|2019-05-24T03:25:00.000Z|132180|
|0048152143LC831|2017-03-07T22:40:00.000Z|2017-06-24T23:55:00.000Z|9209  |
|0110009110EL924|2017-07-23T23:10:00.000Z|2019-02-01T19:55:00.000Z|131305|
|0332939464LC848|2017-03-14T00:30:00.000Z|2018-04-16T23:40:00.000Z|85559 |
|0414614372LCD1E|2017-03-09T21:10:00.000Z|2019-05-24T03:25:00.000Z|152283|
|0432928049LC968|2017-01-13T03:05:00.000Z|2019-05-10T04:00:00.000Z|46593 |
|0900085431PC98B|2017-06-30T04:55:00.000Z|2018-05-09T18:50:00.000Z|44628 |
|1001265690LCA45|2017-03-28T02:55:00.000Z|2019-05-24T03:25:00.000Z|188545|
+---------------+------------------------+------------------------+------+

missing_info_hwd.coalesce(1).write.format('com.databricks.spark.csv').option("header", "true").save('/user/jpe116/output/finaldata/missing_info_hwd')

hdfs dfs -ls /user/jpe116/output/finaldata